<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mitch’s Auto Services – Mobile Mechanic • Stockton-on-Tees</title>
<meta name="description" content="Mobile mechanic in Stockton-on-Tees (+15 mile radius). DVLA number-plate lookup, choose a service with clear 'from' pricing, review details, and request a quote via Email or WhatsApp.">
<style>
  :root {
    --brand:#F06407;
    --accent:#4A4443;
    --ink:#EDEDED;
    --bg:#0b0e13;
    --card:#121720;
    --muted:#9aa1ac;
    --line:#223046;
    --ok:#9cffb0;
    --err:#ff9c9c;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#101623);color:var(--ink);font-family:system-ui, Inter, Arial, sans-serif;line-height:1.45}
  a{color:#ffd6bf;text-decoration:none} a:hover{text-decoration:underline}
  .container{max-width:1140px;margin:0 auto;padding:20px 16px 48px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
  label{display:block;font-weight:700;margin:6px 0}
  input,button{padding:12px;border-radius:10px;border:1px solid #2a3546;background:#0d121a;color:var(--ink);font-size:16px}
  button{cursor:pointer;background:var(--brand);color:#111;font-weight:800;border:none}
  button[disabled]{opacity:.6;cursor:not-allowed}
  .err{color:var(--err)}
</style>
</head>
<body>

<div class="container">
  <h1>Mitch’s Auto Services</h1>
  <p>Enter your registration to check your vehicle via the <b>official DVLA database</b>.</p>

  <form id="vrmForm">
    <label for="vrm">Registration (VRM)</label>
    <input id="vrm" placeholder="e.g. AB12CDE" maxlength="8" required />
    <button id="lookupBtn" type="submit">Look up</button>
  </form>

  <div id="error" class="err" style="display:none;margin-top:10px"></div>

  <div id="vehicleCard" style="display:none;margin-top:20px">
    <h2>Vehicle Details</h2>
    <p id="vehTitle"></p>
    <p id="vehMeta"></p>
    <p id="vehReg"></p>
  </div>
</div>

<script>
const API_URL = '/api/vrm';

const $ = id => document.getElementById(id);
const form = $('vrmForm'), vrmInput = $('vrm'), btn = $('lookupBtn');
const errorBox = $('error'), vehicleCard = $('vehicleCard');
const vehTitle=$('vehTitle'), vehMeta=$('vehMeta'), vehReg=$('vehReg');

form.addEventListener('submit', async e => {
  e.preventDefault();
  errorBox.style.display='none';
  vehicleCard.style.display='none';

  const vrm = vrmInput.value.trim().toUpperCase().replace(/\s+/g,'');
  if (vrm.length < 3) {
    errorBox.textContent = 'Please enter a valid UK registration.';
    errorBox.style.display='block';
    return;
  }

  btn.disabled = true; btn.textContent='Looking…';
  try {
    const res = await fetch(API_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ vrm })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Lookup failed');

    vehTitle.textContent = `${data.make||''} ${data.model||''}`;
    vehMeta.textContent = `${data.fuelType||''} • ${data.engineCapacity? (data.engineCapacity/1000).toFixed(1)+'L':''} • ${data.colour||''}`;
    vehReg.textContent = `Reg: ${vrm}`;

    vehicleCard.style.display='block';
  } catch(err) {
    errorBox.textContent = err.message.includes('Forbidden')
      ? 'DVLA says “Forbidden”: your server is not sending a valid API key yet.'
      : err.message;
    errorBox.style.display='block';
  } finally {
    btn.disabled = false; btn.textContent='Look up';
  }
});
</script>
</body>
</html>
