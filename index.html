<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mitch’s Auto Services – Mobile Mechanic Stockton-on-Tees</title>
<style>
  :root {
    --brand: #F06407;
    --bg: #1b1b1b;
    --card: #2a2a2a;
    --text: #ededed;
    --muted: #aaa;
    --ok: #4caf50;
    --warn: #ff9800;
    --err: #f44336;
  }
  body {
    margin: 0; font-family: Arial, sans-serif; color: var(--text);
    background: linear-gradient(180deg, var(--brand), #000);
    min-height: 100vh;
  }
  .container { max-width: 1000px; margin: auto; padding: 20px; }
  .card {
    background: var(--card); border-radius: 10px; padding: 20px; margin-bottom: 20px;
  }
  h1,h2 { margin: 0 0 10px; }
  label { font-weight: bold; display: block; margin: 10px 0 5px; }
  input,button,select { padding: 10px; font-size: 16px; border-radius: 5px; border: none; }
  input,select { width: 100%; }
  button { background: var(--brand); color: #fff; cursor: pointer; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  .status { margin-top: 10px; font-weight: bold; }
  .ok { color: var(--ok); }
  .warn { color: var(--warn); }
  .err { color: var(--err); }
  .chip { margin: 4px 0; }
</style>
</head>
<body>
<div class="container">
  <h1>Mitch’s Auto Services</h1>
  <p>Unit 5, Wingate Grange Industrial Estate, TS28 5AH — Free call-out within 15 miles, £25 beyond.</p>

  <div class="card">
    <h2>Check your car</h2>
    <form id="vrmForm" onsubmit="event.preventDefault();lookupVRM();">
      <label for="vrm">Registration (VRM)</label>
      <input id="vrm" placeholder="e.g. AB12 CDE" maxlength="8" required>
      <button id="lookupBtn" type="button" onclick="lookupVRM()">Look up</button>
    </form>
    <div id="error" class="err" style="display:none;"></div>

    <div id="vehicleCard" style="display:none;margin-top:15px;">
      <h3 id="vehTitle"></h3>
      <p id="vehMeta"></p>
      <p id="vehReg"></p>
      <p>MOT: <span id="motStatus" class="status"></span></p>
      <p>Tax: <span id="taxStatus" class="status"></span></p>
    </div>
  </div>

  <div class="card" id="servicesCard" style="display:none;">
    <h2>Choose a Service</h2>
    <div id="serviceChips"></div>

    <div id="clarifierBox" style="margin-top:15px;display:none;">
      <h3>Details</h3>
      <div id="clarifierChips"></div>
    </div>

    <div style="margin-top:15px;">
      <h3>Warranty</h3>
      <label class="chip"><input type="radio" name="warr" value="0" checked> 6 months (included)</label>
      <label class="chip"><input type="radio" name="warr" value="20"> 12 months (+£20)</label>
      <label class="chip"><input type="radio" name="warr" value="40"> 18 months (+£40)</label>
    </div>

    <div style="margin-top:15px;">
      <h3>Book Date & Time</h3>
      <input type="date" id="bookDate">
      <input type="time" id="bookTime">
    </div>

    <div style="margin-top:15px;">
      <button onclick="reviewEmail()">Review & Send by Email</button>
    </div>
  </div>
</div>

<script>
const API_URL = '/api/vrm';

const SERVICES = [
  { id:'air_filter', label:'Air Filter Replacement', price:'From £30', desc:'Helps engine breathe better and improve performance.' },
  { id:'basic_service', label:'Basic Service Package', price:'From £100', desc:'Oil, filters, coolant, tyres, lights & battery check.' },
  { id:'battery', label:'Battery Replacement (with coding)', price:'From £200', desc:'New batteries need programming; included in price.' },
  { id:'brakes', label:'Brake Change', price:'From £100', desc:'If brakes feel soft or noisy, it may be time to change.' },
  { id:'brake_fluid', label:'Brake Fluid Flush', price:'From £20', desc:'Old brake fluid reduces performance and safety.' },
  { id:'battery_recharge', label:'Car Battery Recharge', price:'From £20', desc:'We recharge your battery overnight, ready next day.' },
  { id:'diagnostic', label:'Car Diagnostic Check', price:'From £30', desc:'Find the fault using specialised tools before repair.' },
  { id:'refresh', label:'Car Refresh Service', price:'From £600', desc:'Full replacement of key fluids, filters, brakes, lights & battery.' },
  { id:'coolant', label:'Coolant Change', price:'From £30', desc:'Keeps your engine from overheating or freezing.' },
  { id:'pollen', label:'Dust/Pollen Filter Replacement', price:'From £30', desc:'Improves cabin air smell & filtration.' },
  { id:'oil', label:'Engine Oil & Filter Change', price:'From £60', desc:'Fresh oil prevents engine wear and damage.' },
  { id:'fuel', label:'Fuel Filter Replacement', price:'From £40', desc:'Clean filter keeps fuel flowing smoothly to engine.' },
  { id:'lights', label:'Headlights & Rear Lights Replacement', price:'From £60', desc:'Stay legal & safe—replace failed bulbs promptly.' },
  { id:'major', label:'Major Service Package', price:'From £350', desc:'Comprehensive fluids, filters, brakes & plugs replaced.' },
  { id:'minor', label:'Minor Service Package', price:'From £110', desc:'Oil, filters & coolant refreshed.' },
  { id:'premium', label:'Premium Service Package', price:'From £300', desc:'Expanded service incl. spark plugs & checks.' },
  { id:'seasonal', label:'Seasonal Maintenance Package', price:'From £150', desc:'Prepare your car for seasonal changes safely.' },
  { id:'tyres', label:'Tyre Health Check', price:'From £35', desc:'Ensure tread depth (min 1.6mm) to pass MOT & stay safe.' },
  { id:'wipers', label:'Window Wiper Motor Replacement', price:'From £50', desc:'Fix uneven or failing wiper motors.' },
  { id:'mot_prep', label:'Pre-MOT Diagnosis & Repair', price:'£150', desc:'We check your car before MOT to avoid costly failures.' }
];

const CLARIFIERS = {
  brakes:['Front','Rear','Grinding','Pulling','Not sure'],
  battery:['Slow crank','Dead','Dash lights only','Not sure'],
  diagnostic:['Won’t start','Warning light','Noise','Not sure'],
  mot_prep:['MOT due soon','Failed before','Not sure'],
  // EV-specific
  ev:['Battery health','Charging issue','Software fault','Not sure']
};

function renderServices(data){
  const fuel = (data.fuelType||'').toUpperCase();
  let list = SERVICES;
  if (fuel.includes('ELECTRIC')) {
    list = SERVICES.filter(s => !['oil','fuel','coolant','brake_fluid'].includes(s.id));
  }
  const box = document.getElementById('serviceChips');
  box.innerHTML = list.map(s=>`
    <label class="chip">
      <input type="radio" name="srv" value="${s.id}" onclick="renderClarifiers('${s.id}')">
      <b>${s.label}</b> — ${s.price}<br><small>${s.desc}</small>
    </label>
  `).join('');
  document.getElementById('servicesCard').style.display='block';
}
function renderClarifiers(serviceId){
  const opts = CLARIFIERS[serviceId] || (serviceId==='ev'?CLARIFIERS.ev:['Not sure']);
  const box = document.getElementById('clarifierChips');
  box.innerHTML = opts.map(o=>`
    <label class="chip"><input type="radio" name="clar" value="${o}"> ${o}</label>
  `).join('');
  document.getElementById('clarifierBox').style.display='block';
}

window.lookupVRM = async function(){
  const vrm = (document.getElementById('vrm').value||'').toUpperCase().replace(/\s+/g,'');
  const err = document.getElementById('error');
  err.style.display='none';
  if (vrm.length<5){ err.textContent='Enter a valid reg.'; err.style.display='block'; return; }

  const btn=document.getElementById('lookupBtn');
  btn.disabled=true; btn.textContent='Looking…';

  try{
    const res = await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({vrm})});
    const data=await res.json();
    if(!res.ok) throw new Error(data?.error||'Lookup failed');

    document.getElementById('vehTitle').textContent = `${data.make||''} ${data.model||''}`;
    const engine = data.engineCapacity ? (data.engineCapacity/1000).toFixed(1)+'L' : '';
    document.getElementById('vehMeta').textContent = [data.fuelType||'', engine, data.colour||''].filter(Boolean).join(' • ');
    document.getElementById('vehReg').textContent = 'Reg: '+vrm;
    document.getElementById('vehicleCard').style.display='block';

    // MOT
    const motDate = data.motExpiryDate;
    if(motDate){
      const d=new Date(motDate), diff=Math.round((d-new Date())/86400000);
      const el=document.getElementById('motStatus');
      el.textContent = d.toLocaleDateString('en-GB')+` (${diff} days left)`;
      el.className = diff>30?'ok':(diff>=0?'warn':'err');
    }

    // Tax
    const taxStat=(data.taxStatus||'').toUpperCase();
    const el=document.getElementById('taxStatus');
    if(taxStat==='TAXED'){ el.textContent='Taxed'; el.className='ok'; }
    else if(taxStat==='UNTAXED'||taxStat==='SORN'){ el.textContent=taxStat; el.className='err'; }
    else { el.textContent=taxStat||'Unknown'; el.className='warn'; }

    renderServices(data);
  }catch(e){
    err.textContent=e.message; err.style.display='block';
  }finally{
    btn.disabled=false; btn.textContent='Look up';
  }
}

function reviewEmail(){
  const srv=document.querySelector('input[name="srv"]:checked');
  if(!srv){ alert('Pick a service.'); return; }
  const clar=document.querySelector('input[name="clar"]:checked');
  const warr=document.querySelector('input[name="warr"]:checked');
  const date=document.getElementById('bookDate').value;
  const time=document.getElementById('bookTime').value;

  const body=[
    'Service Request:',
    'Service: '+srv.value,
    clar?'Detail: '+clar.value:'',
    'Warranty: '+(warr.value==='0'?'6 months':warr.value==='20'?'12 months':'18 months'),
    date&&time?'Preferred slot: '+date+' '+time:'',
    document.getElementById('vehTitle').textContent,
    document.getElementById('vehMeta').textContent,
    document.getElementById('vehReg').textContent,
    'MOT: '+document.getElementById('motStatus').textContent,
    'Tax: '+document.getElementById('taxStatus').textContent
  ].filter(Boolean).join('%0A');

  window.location=`mailto:support@mitchsautoservices.co.uk?subject=New Service Request&body=${body}`;
}
</script>
</body>
</html>
