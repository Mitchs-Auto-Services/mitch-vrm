<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mitch’s Auto Services – Book a Service</title>
  <style>
    :root {
      --orange: #f47a1f;
      --orange-dark: #d9650e;
      --bg-top: #4a4a4a;
      --bg-bottom: #060606;
      --text: #ffffff;
      --muted: rgba(255,255,255,0.75);
      --border: rgba(255,255,255,0.25);
      --error: #ffb4b4;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, var(--bg-top), var(--bg-bottom));
      min-height: 100vh;
    }
    a { color: inherit; }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 32px 20px 48px;
    }
    header.topbar {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 24px;
    }
    header.topbar h1 {
      margin: 0 0 8px;
      font-size: 2.4rem;
    }
    header.topbar p {
      margin: 0;
      color: var(--muted);
      font-size: 1rem;
    }
    .coverage {
      max-width: 320px;
      margin-left: auto;
      text-align: right;
      font-weight: 600;
      color: var(--text);
    }
    .card {
      background: var(--orange);
      border: 2px solid var(--orange-dark);
      border-radius: 18px;
      padding: 24px;
      margin-bottom: 26px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.35);
    }
    .card h2 {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 1.8rem;
    }
    label {
      font-weight: 700;
      display: block;
      margin-bottom: 6px;
    }
    input, button, select, textarea {
      font-size: 1rem;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.35);
      color: var(--text);
      width: 100%;
    }
    input::placeholder { color: rgba(255,255,255,0.6); }
    button {
      background: var(--orange-dark);
      border: 1px solid rgba(255,255,255,0.35);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }
    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }
    .hint {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.85);
      margin-top: 6px;
    }
    .alert {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 12px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(0,0,0,0.4);
      font-weight: 600;
    }
    .alert.error {
      color: #250000;
      background: rgba(255,215,215,0.8);
      border-color: rgba(255,255,255,0.5);
    }
    .alert.warn {
      background: rgba(0,0,0,0.45);
      border-color: rgba(255,255,255,0.5);
    }
    .result {
      margin-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.35);
      padding-top: 18px;
    }
    .grid-two {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.35);
      font-size: 0.85rem;
      font-weight: 600;
      margin-right: 8px;
    }
    .service-list {
      display: grid;
      gap: 16px;
      margin-top: 18px;
    }
    .service-item {
      background: rgba(0,0,0,0.35);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid rgba(255,255,255,0.35);
      display: grid;
      gap: 10px;
    }
    .service-item header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }
    .service-item h3 {
      margin: 0;
      font-size: 1.25rem;
    }
    .service-item input[type="radio"] {
      width: auto;
      margin-right: 10px;
    }
    .service-item .applicable {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      font-weight: 600;
    }
    .service-item .symptoms {
      margin: 0;
      color: rgba(255,255,255,0.85);
      font-size: 0.95rem;
      line-height: 1.4;
    }
    .option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 12px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.35);
      margin-bottom: 10px;
    }
    .option input[type="radio"] {
      width: auto;
    }
    .hidden { display: none !important; }
    .footer-note {
      margin-top: 14px;
      font-size: 0.95rem;
      color: rgba(255,255,255,0.85);
    }
    @media (max-width: 640px) {
      header.topbar {
        text-align: center;
      }
      .coverage {
        text-align: center;
        margin-left: 0;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="topbar">
      <div>
        <h1>Mitch’s Auto Services</h1>
        <p>Trusted mobile and garage mechanic support — loyalty programme gives you a chance to win a free service!</p>
        <div class="badge">Mobile Work</div>
        <div class="badge">Garage Work</div>
      </div>
      <div class="coverage">We work within a 15 mile radius from Unit 5, Wingate Grange Industrial Estate, TS28 5AH. Anything further is £25 for call out.</div>
    </header>

    <section class="card">
      <h2>Check your vehicle</h2>
      <form id="vrmForm" onsubmit="event.preventDefault(); lookupVRM();" class="grid-two">
        <div>
          <label for="vrm">Vehicle Registration (Reg)</label>
          <input id="vrm" name="vrm" placeholder="Enter your registration" maxlength="8" autocomplete="off" required>
          <div class="hint">We don’t do electric cars right now.</div>
        </div>
        <div style="align-self: end;">
          <button id="lookupBtn" type="submit">Look up</button>
        </div>
      </form>
      <div id="error" class="alert error hidden"></div>

      <div id="vehicleCard" class="result hidden">
        <h3 id="vehTitle"></h3>
        <p id="vehMeta"></p>
        <p id="vehReg"></p>
        <p id="evNotice" class="alert warn hidden"></p>
        <div class="grid-two">
          <div>
            <strong>MOT:</strong>
            <div id="motStatus"></div>
          </div>
          <div>
            <strong>Tax:</strong>
            <div id="taxStatus"></div>
          </div>
        </div>
      </div>

    </section>

    <section id="servicesCard" class="card hidden">
      <h2>Select a service</h2>
      <p>Once we’ve confirmed your vehicle, choose the service you need. All descriptions include symptoms to help you pick the right option.</p>
      <p class="hint">We carry out both mobile and garage work depending on what suits you best.</p>
      <div id="servicesMessage" class="alert warn hidden"></div>
      <div id="serviceList" class="service-list"></div>
      <div id="warrantySection" class="hidden" style="margin-top:24px;">
        <h3>Warranty options</h3>
        <p class="hint">My standard (free) warranty is 6 months. Upgrade for longer cover.</p>
        <label class="option"><input type="radio" name="warr" value="6 months (included)" checked> 6 Months (included)</label>
        <label class="option"><input type="radio" name="warr" value="12 months (+£20)"> 1 Year for £20</label>
        <label class="option"><input type="radio" name="warr" value="18 months (+£40)"> 1 Year 6 Months for £40</label>
        <label class="option"><input type="radio" name="warr" value="Lifetime (price on request)"> Lifetime warranty (price on request – depends on make & model)</label>
      </div>
      <div style="margin-top:24px;" id="finishContainer" class="hidden">
        <button id="finishBtn" onclick="finishBooking()">Finish</button>
        <p class="footer-note">Tap Finish to send us an email with everything we need at <a href="mailto:support@mitchsautoservices.co.uk">support@mitchsautoservices.co.uk</a>.</p>
      </div>
    </section>
  </div>

  <script>
    const API_URL = '/api/vrm';
    const DVLA_FALLBACK_URL = 'https://driver-vehicle-licensing.api.gov.uk/vehicle-enquiry/v1/vehicles';
    const DVLA_FALLBACK_KEY = 'ZQHFV22Ym6ao1CfyyqEol2oxzpoWQM2w59rAkPro';

    const SERVICES = [
      {
        id: 'air_filter',
        title: 'Air Filter Replacement',
        price: 'From £80',
        applicable: ['Petrol', 'Diesel'],
        desc: 'A clogged air filter chokes the engine and hurts performance and MPG.',
        symptoms: 'Symptoms: sluggish acceleration, rough idle, dirty filter on inspection, poor fuel economy.'
      },
      {
        id: 'basic_service',
        title: 'Basic Service Package',
        price: 'From £100',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Oil & filter, air filter, pollen filter, coolant, tyre/light/battery checks to keep everything healthy.',
        symptoms: 'Symptoms: overdue service light, dark/dirty oil, noisy running, uneven wear on tyres.'
      },
      {
        id: 'battery_replacement',
        title: 'Battery Replacement (includes recoding)',
        price: 'From £200',
        applicable: ['Petrol', 'Diesel'],
        desc: 'New batteries on modern cars often need coding to the ECU — included here.',
        symptoms: 'Symptoms: slow crank, repeated jump-starts, random electrical faults, battery warning light.'
      },
      {
        id: 'brake_change',
        title: 'Brake Change',
        price: 'From £100',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Fresh pads/discs restore stopping power and safety.',
        symptoms: 'Symptoms: scraping/squeaking, vibration under braking, longer stopping distance, warning light.'
      },
      {
        id: 'brake_fluid',
        title: 'Brake Fluid Flush',
        price: 'From £70',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Old/contaminated fluid reduces braking performance and pedal feel.',
        symptoms: 'Symptoms: soft/spongy pedal, brake fade on long stops, ABS warnings.'
      },
      {
        id: 'battery_recharge',
        title: 'Car Battery Recharge (overnight)',
        price: 'From £80',
        applicable: ['Petrol', 'Diesel'],
        desc: 'We charge your battery overnight and return it ready to fit the next morning.',
        symptoms: 'Symptoms: hard starting after sitting, low voltage, short trips that never fully recharge.'
      },
      {
        id: 'diagnostic',
        title: 'Car Diagnostic Check',
        price: 'From £50',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Full scan with professional tools; diagnostic report sent to your email for full transparency — “if you’re not sure what’s wrong and you want a mechanic to just give it a check this is the one for you”.',
        symptoms: 'Symptoms: engine light on, won’t start, misfires, strange noises, mystery electrical issues.'
      },
      {
        id: 'refresh',
        title: 'Car Refresh Service',
        price: 'From £600',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Big reset: oil/filters/coolant, plugs check, brake check, tyres, lights, battery — great before selling or after buying.',
        symptoms: 'Symptoms: multiple overdue items, inconsistent maintenance history, general tired running.'
      },
      {
        id: 'coolant',
        title: 'Coolant Change',
        price: 'From £80',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Fresh coolant prevents overheating/corrosion and protects the engine.',
        symptoms: 'Symptoms: high temp gauge, sweet smell, visible leaks, rusty/dirty coolant.'
      },
      {
        id: 'pollen',
        title: 'Dust/Pollen Filter Replacement',
        price: 'From £80',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Improves cabin air, reduces smells, helps demist more efficiently.',
        symptoms: 'Symptoms: musty smells, weak airflow, allergies worse in the car, noisy blower.'
      },
      {
        id: 'oil',
        title: 'Engine Oil & Filter Change',
        price: 'From £60',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Clean oil protects against wear and keeps the engine smooth and efficient.',
        symptoms: 'Symptoms: engine feels rough/noisy, service light, very dark oil, ticking on cold starts.'
      },
      {
        id: 'fuel_filter',
        title: 'Fuel Filter Replacement',
        price: 'From £50',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Keeps debris out of the fuel system for smoother running.',
        symptoms: 'Symptoms: hesitation under load, poor MPG, hard starting, stalling at junctions.'
      },
      {
        id: 'lights',
        title: 'Headlights & Rear Lights Replacement',
        price: 'From £60',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Stay legal and safe with bright, working lights.',
        symptoms: 'Symptoms: dim or failed bulbs, warnings on dash, poor night visibility.'
      },
      {
        id: 'major_service',
        title: 'Major Service Package',
        price: 'From £350',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Oil/filters, coolant & brake fluid flushes, plugs, and full brake replacement where needed.',
        symptoms: 'Symptoms: high mileage or long interval since last big service, noisy/harsh running.'
      },
      {
        id: 'minor_service',
        title: 'Minor Service Package',
        price: 'From £110',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Oil/filters and coolant refreshed — ideal between major services.',
        symptoms: 'Symptoms: due for an interim service, moderate mileage increase since last visit.'
      },
      {
        id: 'premium_service',
        title: 'Premium Service Package',
        price: 'From £300',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Oil/filters, coolant, plugs, plus brake/tyre/light/battery health checks.',
        symptoms: 'Symptoms: general tune-up needed, inconsistent performance, long trip coming up.'
      },
      {
        id: 'pre_mot',
        title: 'Pre-MOT Diagnosis & Repair',
        price: '£150',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Full MOT-style check so you don’t waste money failing and retesting.',
        symptoms: 'Symptoms: MOT due soon, unsure what might fail, known issues not yet fixed.'
      },
      {
        id: 'seasonal',
        title: 'Seasonal Maintenance Package',
        price: 'From £150',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Prep for winter/summer: fluids, battery, tyres, wipers — safe and ready for the season.',
        symptoms: 'Symptoms: heading into cold snaps or heatwaves, long road trip planned.'
      },
      {
        id: 'tyre_check',
        title: 'Tyre Health Check',
        price: 'From £35',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Legal tread (1.6mm min), wear pattern, pressures, valve/sidewall condition.',
        symptoms: 'Symptoms: pulling to one side, vibration at speed, uneven/rapid wear, visible cracks.'
      },
      {
        id: 'wiper_motor',
        title: 'Window Wiper Motor Replacement',
        price: 'From £50',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Get consistent, smooth wiper operation for clear visibility.',
        symptoms: 'Symptoms: wipers slow, stop mid-sweep, out of sync, burning smell from wiper area.'
      },
      {
        id: 'ac',
        title: 'Air Conditioning Top-Up/Recharge',
        price: 'From £85',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Restore cold air, improve demisting, and check for obvious leaks.',
        symptoms: 'Symptoms: weak/no cold air, bad odours through vents, windows slow to clear, groaning compressor.'
      },
      {
        id: 'fuel_injector',
        title: 'Fuel Injector Replacement (includes Recoding)',
        price: 'From £150',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Modern injectors often need coding to the ECU after replacement — included in this price.',
        symptoms: 'Symptoms: rough idle, misfiring, poor MPG, fuel smell, hard starting, loss of power.'
      },
      {
        id: 'glow_plug',
        title: 'Glow Plug Replacement',
        price: 'From £50',
        applicable: ['Diesel'],
        desc: 'Essential for cold starts on diesel engines.',
        symptoms: 'Symptoms: hard starting in cold weather, white smoke on start-up, rough running until warm.'
      },
      {
        id: 'spark_plug',
        title: 'Spark Plug Replacement',
        price: 'From £50',
        applicable: ['Petrol'],
        desc: 'Healthy spark plugs keep your petrol engine smooth and efficient.',
        symptoms: 'Symptoms: misfires, poor acceleration, high fuel consumption, trouble starting.'
      },
      {
        id: 'ignition',
        title: 'Ignition Coils / Leads Replacement',
        price: 'From £80',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Faulty coils/leads can cause misfiring and poor engine performance.',
        symptoms: 'Symptoms: engine misfire, check engine light, jerky acceleration, fuel smell from exhaust.'
      },
      {
        id: 'handbrake',
        title: 'Handbrake Adjustment',
        price: 'From £150',
        applicable: ['Petrol', 'Diesel'],
        desc: 'Keeps your parking brake working safely and holding the car securely.',
        symptoms: 'Symptoms: handbrake pulls up too high, car rolls on hills, poor MOT handbrake result.'
      }
    ];

    let vehicleDetails = null;

    async function fetchVehicleDetails(vrm) {
      let fallbackReason = null;
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ vrm }),
          cache: 'no-store'
        });

        let data = null;
        try {
          data = await response.json();
        } catch (parseError) {
          data = null;
        }

        if (!response.ok) {
          if (response.status >= 400 && response.status < 500) {
            throw new Error(data?.error || data?.message || 'Lookup failed');
          }

          fallbackReason = `API responded with status ${response.status}`;
          throw new Error(data?.error || data?.message || 'Lookup failed');
        }

        return data || {};
      } catch (err) {
        if (!fallbackReason && !(err instanceof TypeError)) {
          throw err;
        }

        const fallbackResponse = await fetch(DVLA_FALLBACK_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': DVLA_FALLBACK_KEY
          },
          body: JSON.stringify({ registrationNumber: vrm }),
          mode: 'cors',
          cache: 'no-store'
        });

        let fallbackData = null;
        try {
          fallbackData = await fallbackResponse.json();
        } catch (parseError) {
          fallbackData = null;
        }

        if (!fallbackResponse.ok) {
          throw new Error(fallbackData?.message || fallbackData?.error || 'Lookup failed');
        }

        return fallbackData || {};
      }
    }

    function normaliseFuel(fuel) {
      const value = (fuel || '').toUpperCase();
      if (value.includes('ELECTRIC')) return 'Electric';
      if (value.includes('DIESEL')) return 'Diesel';
      if (value.includes('PETROL')) return 'Petrol';
      if (value.includes('HYBRID')) {
        return value.includes('DIESEL') ? 'Diesel' : 'Petrol';
      }
      return 'Both';
    }

    function renderVehicle(data, vrm) {
      vehicleDetails = data;
      const title = [data.make, data.model].filter(Boolean).join(' ');
      document.getElementById('vehTitle').textContent = title || 'Vehicle details';
      const engine = data.engineCapacity ? `${(data.engineCapacity/1000).toFixed(1)}L` : '';
      const metaBits = [data.fuelType, engine, data.colour].filter(Boolean).join(' • ');
      document.getElementById('vehMeta').textContent = metaBits;
      document.getElementById('vehReg').textContent = `Reg: ${vrm}`;

      // MOT
      const motStatus = document.getElementById('motStatus');
      if (data.motExpiryDate) {
        const motDate = new Date(data.motExpiryDate);
        const days = Math.round((motDate - new Date()) / 86400000);
        const dayText = isNaN(days) ? '' : ` (${days} days left)`;
        motStatus.textContent = `${motDate.toLocaleDateString('en-GB')}${dayText}`;
      } else {
        motStatus.textContent = 'Unknown';
      }

      // Tax
      const taxStatus = document.getElementById('taxStatus');
      taxStatus.textContent = (data.taxStatus || 'Unknown');

      const evNotice = document.getElementById('evNotice');
      if (normaliseFuel(data.fuelType) === 'Electric') {
        evNotice.textContent = 'We do not do electric just yet but we are hoping to expand to them soon.';
        evNotice.classList.remove('hidden');
      } else {
        evNotice.classList.add('hidden');
        evNotice.textContent = '';
      }

      document.getElementById('vehicleCard').classList.remove('hidden');
    }

    function renderServices(data) {
      const messageBox = document.getElementById('servicesMessage');
      const listBox = document.getElementById('serviceList');
      const warranty = document.getElementById('warrantySection');
      const finish = document.getElementById('finishContainer');

      listBox.innerHTML = '';

      const fuel = normaliseFuel(data.fuelType);
      if (fuel === 'Electric') {
        messageBox.textContent = 'We do not do electric just yet but we are hoping to expand to them soon. Please check back later!';
        messageBox.classList.remove('hidden');
        warranty.classList.add('hidden');
        finish.classList.add('hidden');
        return;
      }

      warranty.querySelectorAll('input[name="warr"]').forEach((input, index) => {
        input.checked = index === 0;
      });

      warranty.classList.add('hidden');
      finish.classList.add('hidden');

      const available = SERVICES.filter(service =>
        fuel === 'Both' || service.applicable.length === 2 || service.applicable.includes(fuel)
      );

      if (available.length === 0) {
        messageBox.textContent = 'No services available for this vehicle type just yet — please contact us for help.';
        messageBox.classList.remove('hidden');
        warranty.classList.add('hidden');
        finish.classList.add('hidden');
        return;
      }

      const typeText = fuel === 'Both' ? 'your vehicle type' : `${fuel.toLowerCase()} vehicles`;
      messageBox.textContent = `Showing services for ${typeText}.`;
      messageBox.classList.remove('hidden');

      listBox.innerHTML = available.map(service => `
        <label class="service-item">
          <header>
            <div>
              <h3>${service.title}</h3>
              <div class="applicable">${service.price} (${service.applicable.length === 2 ? 'Both' : service.applicable.join(', ')})</div>
            </div>
            <input type="radio" class="service-radio" name="srv" value="${service.id}" data-title="${service.title}" data-price="${service.price}">
          </header>
          <div>${service.desc}</div>
          <p class="symptoms">${service.symptoms}</p>
        </label>
      `).join('');

      listBox.querySelectorAll('input[name="srv"]').forEach(input => {
        input.addEventListener('change', () => {
          warranty.classList.remove('hidden');
          finish.classList.remove('hidden');
        });
      });

      document.getElementById('servicesCard').classList.remove('hidden');
    }

    async function lookupVRM() {
      const input = document.getElementById('vrm');
      const vrm = (input.value || '').toUpperCase().replace(/\s+/g, '');
      const errorBox = document.getElementById('error');
      errorBox.classList.add('hidden');
      errorBox.textContent = '';

      if (vrm.length < 5) {
        errorBox.textContent = 'Please enter a valid registration (at least 5 characters).';
        errorBox.classList.remove('hidden');
        return;
      }

      const button = document.getElementById('lookupBtn');
      button.disabled = true;
      button.textContent = 'Looking…';

      try {
        const data = await fetchVehicleDetails(vrm);
        renderVehicle(data, vrm);
        renderServices(data);
      } catch (err) {
        errorBox.textContent = err.message || 'Something went wrong while looking up the registration.';
        errorBox.classList.remove('hidden');
      } finally {
        button.disabled = false;
        button.textContent = 'Look up';
      }
    }

    function finishBooking() {
      const serviceInput = document.querySelector('input[name="srv"]:checked');
      if (!serviceInput) {
        alert('Please pick a service.');
        return;
      }

      const warrantyInput = document.querySelector('input[name="warr"]:checked');
      const details = [
        `Vehicle: ${document.getElementById('vehTitle').textContent}`,
        document.getElementById('vehMeta').textContent ? `Details: ${document.getElementById('vehMeta').textContent}` : '',
        document.getElementById('vehReg').textContent,
        `MOT: ${document.getElementById('motStatus').textContent}`,
        `Tax: ${document.getElementById('taxStatus').textContent}`,
        `Service: ${serviceInput.dataset.title} (${serviceInput.dataset.price})`,
        warrantyInput ? `Warranty: ${warrantyInput.value}` : ''
      ].filter(Boolean).join('\n');

      const subject = encodeURIComponent('Service Booking Request');
      const body = encodeURIComponent(`${details}\n\nPlease contact me to confirm availability.`);
      window.location.href = `mailto:support@mitchsautoservices.co.uk?subject=${subject}&body=${body}`;
    }

    window.lookupVRM = lookupVRM;
    window.finishBooking = finishBooking;
  </script>
</body>
</html>
